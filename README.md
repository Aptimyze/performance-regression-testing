# WJAX Demonstration Application
## Windows
### Jenkins
Go to http://localhost:8090 in your browser to open up the Jenkins web interface. After the initial startup you are asked to enter the administration password which is generated by Jenkins. The administrator password can be found in the logs of the docker container by using the command `docker logs -f jenkins` in your command line interface. Look for a line similiar to this one:


```
Jenkins initial setup is required. An admin user has been created and a password generated.
Please use the following password to proceed to installation:

0f3b91ab8e8d479781085870f31f6de9

This may also be found at: /var/jenkins_home/secrets/initialAdminPassword
```

When you have found this line please copy paste the admin password to Jenkins and create your own admin user afterwards.

#### Install required plugins
Go to the available plugins page (http://localhost:8090/pluginManager/available) in Jenkins and install the following two plugins:

- Performance Plugin
- Parameterized Trigger Plugin
- Hudson Post build task

#### Import Jobs
There are two jobs in this repository which have to be imported into Jenkins by copy pasting the folders into `jenkins_home/jobs`. After copying the jobs you have to restart Jenkins with `docker restart jenkins`. Afte restaring Jenkins you should now be able to see the following two new jobs in the Jenkins job overview:

- spring-pet-clinic CI load test
- spring-pet-clinic-cleanup

## Docker (Unix Systems)
Install docker and docker-compose on your system if not already installed.
Please consult the docker documentation to find out how to install docker
on your system: https://docs.docker.com/engine/installation/  
Please see https://docs.docker.com/compose/install/ to find instructions
for your platform to install docker-compose.

### Configure Docker
Before we can start the docker containers we have to adjust the computing resources dedicated to docker by going to the preferences page of docker. That is necessary as building and running all microservices consumes a lot of memory. So we should set the memory to at least 10GB and assign as many CPU Cores as possible.
### Docker Compose
To start the entire Demo check out this project and go inside the main directory where you can find the `docker-compose.yml` file.

#### Build
Now run `docker-compose build` to build all docker containers.

#### Run
After building the Demo Application start up all docker containers by
running the command `docker-compose up`. To start the containers in the
background use `docker-compose up -d`

This will start the following docker containers on your system:

- jenkins
- influxdb
- inspectIT-CMR
- grafana

To see logs about one container use `docker logs -f <container-name>`.

#### Stop and Remove
To stop all containers and remove them use `docker-compose down`

#### Clear caches
To clean up the docker caches and remove all unused containers use
`docker system prune -a`.

## Grafana
Grafana can be accessed by going to http://localhost:3000 in your browser. To login use the default `admin` user with the default password `admin`.
The next step is to add the InfluxDB as your datasource to Grafana.

### Add Data Source
#### JMeter
Click on the add data source icon and enter `JMeter` as name for this datasource. Next select the `InfluxDB` from the available database types list.
For the HTTP settings select http://influxdb:8086 as your datasource URL and use `proxy` as access method.
We can skip the rest and go directly to the InfluxDB Details section where we will enter `jmeter` as Database and `admin` as user and password. Click on Save and Test and a green message should appear that the datasource is working.

### InspectIT
Click on the add data source icon and enter `InspectIT` as name for this datasource. Next select the `InfluxDB` from the available database types list.
For the HTTP settings select http://influxdb:8086 as your datasource URL and use `proxy` as access method.
We can skip the rest and go directly to the InfluxDB Details section where we will enter `inspectit` as Database and `admin` as user and password. Click on Save and Test and a green message should appear that the datasource is working.

### Installing Dashboards
Next we are going to import some Dashboards we need to see live JMeter data and InspectIT data. To do so go to the dashboard import page ( http://localhost:3000/dashboard/new?editview=import&orgId=1)
and import the following two dashbards:

- https://grafana.com/dashboards/1152  
Select `JMeter` as datasource
- https://grafana.com/dashboards/1691  
Select `InspectIT` as datasource

## InspectIT
### Install InspectIT
Go to http://www.inspectit.rocks/ and download the latest InspectIT version for your operating system.
Start the installation process by executing the `jar` file.
Select your preferred installation directory. You are only required to install the `inspectIt UI` as the
other two components will run inside the docker containers.

## Jenkins
Go to http://localhost:8090 in your browser to open up the Jenkins web interface.
You will have access to one project which is called `spring-pet-clinic-ci-load-test-docker`
and will checkout the Pet Clinic project and starts a load test by using JMeter.

### Start load test
Go to http://localhost:8090/job/spring-pet-clinic-ci-load-test-docker/ and click on `Build with parameters` to start a new build with a load test. On the build parameters page click `Build`.

### Console Output
To follow the build and load test progress go inside the current build and click on `Console Output`.
